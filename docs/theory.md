# Теория рекомендательных систем

## I. Обзор. 

**Рекомендательные системы**  
- класс алгоритмов, предназначенных для предсказания предпочтений пользователей.  

**Зачем нужны RS**
- 30-50 % дохода Netflix/Spotify приходит из-за рекомендаций.
- Пользователь не ищет - ему подбирают → вырастает вовлечение и удержание.
  
**Цель рекомендации**  
- предсказать, какие items понравятся пользователю, опираясь на явный и/или неявный фидбек.

**Основные задачи**
- предсказание рейтинга (rating prediction) и ранжирование (top‑N recommendation). ((*В проекте фокус на top‑N задачах с implicit сигналами, но рассматриваются и классы моделей для explicit рейтингов.*))  

**Ключевые понятия**
- Пользователь - user
- Предмет рекомендаций - item
- Взаимодействие представляется матрицей R size |U|×|I|.
- Explicit фидбек - числовые рейтинги.
- Implicit фидбек - клики, просмотры, покупки, преобразуемые в бинарные метки.
- Top‑N pipeline часто состоит из двух этапов: кандидатная генерация (recall) и точное ранжирование (ranking).
  
## II. Формализуем задачу
**Дано:**
- U - множество пользователей, |U| = N
- I - множество item-ов, |I| = M
- Интеракции R = {r_ui} - рейтинги, просмотры, клики (explicit / implicit).

**Цель:**
- для каждого **u** построить ранжированный список Top-K item-ов, которых он ещё не видел.
  
## III. Виды рекомендательных систем:
![Виды рекомендательных систем.](https://github.com/Aliaksandr-Borsuk/Recommender_Systems_project/blob/main/pictures/Types%20of%20recommendation%20systems.jpg)  

## 1 Неперсонализированные (Non-personalized) рекомендации 
**(Most-popular)Коротко:**
- одинаковый набор рекомендаций для всех пользователей на основе глобальных сигналов.

**Когда использовать**
- Cold‑start и стартовые экраны.
- Редакционные и промо‑блоки.
- Базовый baseline и запасной путь при сбое персонализации.

**Основные типы**
- Популярность - топ по суммарным взаимодействиям.
- Тренды - ранжирование по росту активности.
- Категория‑топы - топы внутри разделов каталога.
- Редакционные списки - ручные подборки.

**Реализация кратко**
- Агрегируем события за окна 1/7/30 дней, используем взвешивание по времени для свежести.
- Храним в базе с периодическим обновением top‑lists для быстрой выдачи .
- Обработка новых айтемов через cold‑start bucket или выделенные exploration‑слоты.

**Bandit‑алгоритмы (коротко)**
- ищут trade-off(компромисс «изучение - использование»)
  
**Назначение:**
- баланс exploration/exploitation для global‑слотов, повышение шансов новых айтемов и оптимизация онлайн‑метрик.

**Основные простые алгоритмы:** 
- Epsilon‑Greedy (baseline), UCB (неопределённость), Thompson Sampling (байесовский подход).

## 2 Персонализированные (Personalized) рекомендации 
### 2.1 Контентная фильтрация (Content-based)
- **Идея**: Рекомендации на основе характеристик items(жанры, TF-IDF описания, год), users(возраст, любимые жанры).
- **Методы**: TF-IDF, word2vec, feature engineering

### 2.2 Коллаборативная фильтрация (Collaborative Filtering)
- **Идея**: Похожие пользователи предпочитают похожие items

#### **2.2.1 Memory-based подходы** 
- **Идея**:агрегировать извнстные рейтинги для предсказания неизвестного рейтинга  $r_{ui}$

##### **UserKNN**
- Рекомендация = средневзвешенная оценка k наиболее похожих пользователей  
**Преимущества**:  
- Простота интерпретации
- Быстрое обновление при новых данных  
**Недостатки**:
- Проблема разреженности данных
- Медленный инференс для новых пользователей  

##### **ItemKNN**
- Рекомендация = средневзвешенная оценка k наиболее похожих items  

**Преимущества**:  
- Стабильность (количество items обычно постоянно)
- Быстрый инференс после предвычисления 

#### **2.2.2 Model-based подходы** 

#### **Matrix Factorization подходы:**

##### **SVD (Singular Value Decomposition)**
- Разложение матрицы оценок R ≈ U × Σ × Vᵀ
- Latent factors: пользователи и items в одном пространстве

##### **ALS (Alternating Least Squares)**
- Оптимизация поочередно пользовательских и item факторов
- Эффективно для implicit feedback

#### **Linear Models:**

##### **EASE (Embarrassingly Shallow Autoencoders)**
- Closed-form решение для обучения
- Диагональное ограничение весов
- Высокая точность при простоте

##### **SLIM (Sparse Linear Methods)**
- Разреженные линейные комбинации
- L1-регуляризация для sparsity

#### **Нейро подходы:**

##### **NCF (Neural Collaborative Filtering)**
- MLP поверх эмбеддингов пользователей и items
- Нелинейные взаимодействия между факторами

##### **Two-Tower архитектура**
- Отдельные энкодеры для пользователей и items
- Contrastive learning для обучения представлений


## 3 Гибридные подходы (Hybrid Recommendation Systems)

**Идея**: объединение контентных и коллаборативных сигналов для повышения качества рекомендаций.  
- Используются одновременно признаки items (жанры, описания, эмбеддинги) и взаимодействия пользователей.  
- Позволяют работать в условиях cold‑start (новые пользователи или новые фильмы).  

**Основные варианты:**
- **Feature‑augmented MF**: добавление контентных признаков в матричную факторизацию.  
- **Two‑Tower модели**: отдельные энкодеры для пользователей и items, обучаемые совместно.  
- **Hybrid pipelines**: сначала коллаборативная генерация кандидатов, затем контентное ранжирование.  

**Преимущества:**
- Устойчивость к cold‑start.  
- Возможность использовать мультимодальные данные (текст, изображения, метаданные).  
- Гибкость архитектуры.  

**Недостатки:**
- Более сложная настройка и обучение.  
- Требуют больше данных и вычислительных ресурсов.  

---

## IV. Метрики оценки

**Зачем нужны метрики**  
- Позволяют сравнивать модели по точности и полезности рекомендаций.  
- Важны как оффлайн‑метрики (на тестовых данных), так и онлайн‑метрики (A/B‑тесты).

**Основные оффлайн‑метрики:**
- **HitRate@K** - доля пользователей, для которых релевантный item попал в топ‑K.  
- **Precision@K** - точность: доля релевантных items среди рекомендованных.  
- **Recall@K** - полнота: доля найденных релевантных items.  
- **NDCG@K** - учитывает позицию релевантных items в списке (ранжирование).  
- **MAP@K** - средняя точность по всем пользователям.  
- **Coverage@K** - охват: доля уникальных items, попавших в рекомендации.  

**Онлайн‑метрики:**
- CTR (Click‑Through Rate) - отношение числа кликов на рекомендацию к числу показов.
- Conversion Rate - доля пользователей, которые после клика совершили целевое действие (покупка, подписка, просмотр фильма). 
- Retention / Engagement
   - Retention (удержание): процент пользователей, которые вернулись в сервис спустя определённое время (например, через неделю или месяц).
   - Engagement (вовлечённость): глубина и частота взаимодействий (количество просмотров, лайков, времени в приложении).
- Revenue uplift - прирост дохода, связанный с внедрением рекомендаций. 

---

## V. Практические аспекты

**1. Data pipeline**
- Сбор и хранение логов (просмотры, клики, покупки).  
- Очистка и нормализация данных.  
- Построение train/test split (часто по времени).  

**2. Candidate generation vs Ranking**
- Recall: быстрое получение множества кандидатов (KNN, ALS, ANN‑поиск).  
- Ranking: точное упорядочивание (MLP, GBM, трансформеры).  

**3. Cold‑start**
- Новые пользователи - Most Popular, демографические признаки.  
- Новые items - контентные признаки (жанры, описания, постеры).  

**4. Инфраструктура**
- Онлайн‑выдача требует быстрых моделей (EASE, ANN‑индексы).  
- Обновление моделей: периодическое переобучение или online‑learning.  
- A/B‑тестирование для проверки гипотез.  

---

## VI. Современные направления

**Sequence‑based модели**
- SASRec, BERT4Rec - трансформеры для последовательностей взаимодействий.  
- Учитывают порядок и временные интервалы.  

**Graph‑based RS**
- Используют граф пользователей и items.  
- Методы: GraphSAGE, GCN, LightGCN.  

**Мультимодальные RS**
- Интеграция текста, изображений, аудио.  
- Пример: рекомендации фильмов по постерам + описаниям.  

**Bandit‑алгоритмы**
- Онлайн‑обучение с exploration/exploitation.  
- Применяются для динамических витрин и промо‑слотов.  

---

## VII. Заключение

Рекомендательные системы — ключевой компонент современных онлайн‑сервисов.  
- **Классические методы** (KNN, SVD, ALS) остаются сильными и интерпретируемыми.  
- **Линейные модели** (EASE, SLIM) дают высокую точность при простоте.  
- **Нейросетевые подходы** (NCF, Two‑Tower, трансформеры) открывают возможности для сложных взаимодействий и cold‑start.  
- **Гибридные системы** обеспечивают баланс между точностью и разнообразием.  

Выбор метода зависит от:
- типа данных (explicit / implicit),  
- размера и разреженности матрицы,  
- требований к скорости инференса,  
- целей бизнеса (точность vs разнообразие vs устойчивость к cold‑start).  


